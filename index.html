<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>I-3 Napadaci iz svemira</title>
<style>
  body { margin: 0; background: black; overflow: hidden; font-family: monospace; text-align: center; color: #fff; }
  h1 { margin: 20px 0 10px 0; font-size: 36px; color: #00ffff; text-shadow: 2px 2px #000; }
  canvas { display: block; margin: auto; background: #000; border: 2px solid #fff; }
  
  /* Modal styles */
  #gameOverModal {
    display: none; /* hidden by default */
    position: fixed;
    top: 0; left: 0; right:0; bottom:0;
    background: rgba(0,0,0,0.8);
    color: #fff;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 10;
    text-align: center;
  }
  #gameOverModal h2 { font-size: 36px; margin-bottom: 20px; }
  #gameOverModal p { font-size: 24px; margin-bottom: 30px; }
  #restartBtn {
    padding: 15px 30px;
    font-size: 20px;
    cursor: pointer;
    background-color: #00ffff;
    border: none;
    border-radius: 10px;
    color: black;
    font-weight: bold;
  }
  #restartBtn:hover { background-color: #00cccc; }

</style>
</head>
<body>

<h1>I-3 Napadaƒçi iz svemira</h1>

<!-- Game Over Modal -->
<div id="gameOverModal">
  <h2>Kraj igre</h2>
  <p id="finalScore">Tvoj rezultat: 0</p>
  <button id="restartBtn">Ponovo</button>
</div>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let score = 0;
let gameOver = false;
let gameStarted = false; // Wait until first Space press

// Spaceship SVG (white)
const spaceshipSVG = `
<svg width="50" height="50" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
  <polygon points="25,0 45,50 25,40 5,50" fill="#ffffff" stroke="#ffffff" stroke-width="2"/>
  <circle cx="25" cy="15" r="5" fill="#ffffff" stroke="#ffffff" stroke-width="1"/>
  <polygon points="20,50 25,60 30,50" fill="#ffffff" stroke="#ffffff" stroke-width="1"/>
</svg>`;
const playerImg = new Image();
playerImg.src = 'data:image/svg+xml;base64,' + btoa(spaceshipSVG);

// Player & bullets
let player = { x: 380, y: 520, width: 50, height: 50, speed: 5 };
let bullets = [];
let enemies = [];
let enemyBullets = [];
const enemySprites = [];
for(let i=1; i<=26; i++){
  const img = new Image();
  img.src = `sprites/${i}.png`;
  enemySprites.push(img);
}

// Enemy grid parameters
const rows = 4;
const cols = 8;
const spacingX = 80;
const spacingY = 60;
const enemyWidth = 60;
const enemyHeight = 60;

function createEnemyGrid(startY = 50){
  enemies = []; // clear old enemies
  for(let r=0; r<rows; r++){
    for(let c=0; c<cols; c++){
      const spriteIndex = Math.floor(Math.random() * enemySprites.length);
      enemies.push({
        x: 50 + c*spacingX,
        y: startY + r*spacingY,
        width: enemyWidth,
        height: enemyHeight,
        dx: 1,
        sprite: enemySprites[spriteIndex]
      });
    }
  }
}
createEnemyGrid();

// Controls
const keys = {};
document.addEventListener('keydown', e => {
  keys[e.key] = true;

  // Shoot bullets
  if(e.key === ' ' && !gameOver){
    bullets.push({ x: player.x + player.width/2 - 2, y: player.y, width: 4, height: 10, dy: -8 });
    if(!gameStarted){
      gameStarted = true;
      gameLoop();
    }
  }

  // Restart game by pressing Enter
  if(e.key === 'Enter' && gameOver){
    restartGame();
  }
});
document.addEventListener('keyup', e => keys[e.key] = false);

// Update functions
function updatePlayer(){
  if(keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
  if(keys['ArrowRight'] && player.x + player.width < canvas.width) player.x += player.speed;
}

function updateBullets(){
  for(let i = bullets.length - 1; i >= 0; i--){
    bullets[i].y += bullets[i].dy;
    if(bullets[i].y < 0){
      bullets.splice(i, 1);
      continue;
    }

    for(let j = enemies.length - 1; j >= 0; j--){
      const e = enemies[j];
      const b = bullets[i];
      if(b.x < e.x + e.width &&
         b.x + b.width > e.x &&
         b.y < e.y + e.height &&
         b.y + b.height > e.y){
        bullets.splice(i,1);
        enemies.splice(j,1);
        score++;
        break;
      }
    }
  }

  if(enemies.length === 0){
    createEnemyGrid();
  }
}

let enemyDir = 1;
function updateEnemies(){
  let shiftDown = false;
  enemies.forEach(e => {
    e.x += e.dx * enemyDir;
    if(e.x + e.width > canvas.width || e.x < 0) shiftDown = true;

    if(Math.random() < 0.002) e.y += 20;
    if(Math.random() < 0.002) enemyBullets.push({ x: e.x + e.width/2 - 2, y: e.y + e.height, width: 4, height: 10, dy: 4 });

    if(e.x < player.x + player.width &&
       e.x + e.width > player.x &&
       e.y < player.y + player.height &&
       e.y + e.height > player.y){
      endGame();
    }
  });

  if(shiftDown){
    enemyDir *= -1;
    enemies.forEach(e => e.y += 20);
  }
}

function updateEnemyBullets(){
  for(let i=enemyBullets.length-1; i>=0; i--){
    const b = enemyBullets[i];
    b.y += b.dy;
    if(b.y > canvas.height) { enemyBullets.splice(i,1); continue; }

    if(b.x < player.x + player.width &&
       b.x + b.width > player.x &&
       b.y < player.y + player.height &&
       b.y + b.height > player.y){
      endGame();
    }
  }
}

// Draw functions
function drawPlayer(){ ctx.drawImage(playerImg, player.x, player.y, player.width, player.height); }
function drawBullets(){ ctx.fillStyle = 'white'; bullets.forEach(b => ctx.fillRect(b.x,b.y,b.width,b.height)); }
function drawEnemies(){ enemies.forEach(e => ctx.drawImage(e.sprite,e.x,e.y,e.width,e.height)); }
function drawEnemyBullets(){ ctx.fillStyle = 'white'; enemyBullets.forEach(b => ctx.fillRect(b.x,b.y,b.width,b.height)); }
function drawScore(){ ctx.fillStyle = '#fff'; ctx.font = '20px monospace'; ctx.fillText(`Rezultat: ${score}`, 10, 25); }
function drawStartMessage(){ 
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawPlayer();
  drawEnemies();
  ctx.fillStyle = 'white';
  ctx.font = '24px monospace';
  ctx.fillText("Pritisni Space za pucanje", canvas.width/2 - 150, canvas.height/2);
}

// Game loop
function gameLoop(){
  if(gameOver) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  updatePlayer();
  updateBullets();
  updateEnemies();
  updateEnemyBullets();
  drawPlayer();
  drawBullets();
  drawEnemies();
  drawEnemyBullets();
  drawScore();
  requestAnimationFrame(gameLoop);
}

// End game
function endGame(){
  gameOver = true;
  document.getElementById('finalScore').innerText = `Tvoj rezultat: ${score}`;
  document.getElementById('gameOverModal').style.display = 'flex';
}

// Restart game
function restartGame(){
  score = 0;
  bullets = [];
  enemyBullets = [];
  player.x = 380;
  gameOver = false;
  gameStarted = false;
  document.getElementById('gameOverModal').style.display = 'none';
  createEnemyGrid();
  drawStartMessage();
}

// Restart button
document.getElementById('restartBtn').addEventListener('click', restartGame);

// Initial draw
drawStartMessage();
</script>
</body>
</html>
